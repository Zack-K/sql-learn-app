<!-- editor.html: HTMXã§ãƒ¡ã‚¤ãƒ³é ˜åŸŸã«å·®ã—è¾¼ã¾ã‚Œã‚‹éƒ¨åˆ†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
<div class="content-header">
    {% if drill_data %}
    <h2>Day {{ active_day }}: {{ drill_data.title }}</h2>
    <p class="goal-text"><strong>ğŸ¯ ç›®çš„:</strong> {{ drill_data.goal }}</p>
    {% else %}
    <h2>Day {{ active_day }}</h2>
    <p>ã¾ã å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
    {% endif %}
</div>

{% if drill_data %}
<div class="drill-section">
    <!-- å•é¡Œæ–‡ã¨å‰æã‚¹ã‚­ãƒ¼ãƒ -->
    <div class="question-pane">
        <h3>ğŸ“„ èª²é¡Œ</h3>
        <div class="question-text">
            {{ drill_data.question | markdown | safe }}
        </div>

        {% if drill_data.schema %}
        <div class="schema-box">
            <h4>å‰æãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ</h4>
            <ul>
                {% for table in drill_data.schema %}
                <li><code>{{ table.table_name.split(' ')[0].replace('.', '_') }}</code> ({{ table.columns | join(', ')
                    }})</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>

    <!-- SQL Playground (ãƒ‡ãƒ¼ã‚¿æ¢ç´¢) é ˜åŸŸ -->
    <div class="playground-pane">
        <h3>ğŸ” SQL Playground (ãƒ‡ãƒ¼ã‚¿æ¢ç´¢)</h3>
        <p style="font-size: 0.9em; color: var(--text-dim); margin-top: 0;">
            å‰æãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã—ã¦å®Ÿéš›ã®SQLï¼ˆSELECTæ–‡ï¼‰ã‚’å®Ÿè¡Œã—ã€ä¸­èº«ã‚’ç¢ºèªã§ãã¾ã™ã€‚ï¼ˆâ€»ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªDBã®ä½¿ã„æ¨ã¦å®Ÿè¡Œã§ã™ï¼‰
        </p>
        <form hx-post="/run_sql/{{ active_day }}" hx-target="#sql-result" hx-indicator="#sql-spinner">
            <textarea name="sql_query" class="code-editor sql-query-input"
                placeholder="SELECT * FROM table_name LIMIT 10;" rows="3"></textarea>
            <div style="margin-top: 10px;">
                <button type="submit" class="btn btn-execute">SQLå®Ÿè¡Œ â–¶</button>
                <span id="sql-spinner" class="htmx-indicator" style="margin-left: 10px;">å®Ÿè¡Œä¸­...</span>
            </div>
        </form>
        <!-- SQLå®Ÿè¡Œçµæœã®è¡¨ç¤ºé ˜åŸŸ -->
        <div id="sql-result"></div>
    </div>

    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼è§£ç­”ãƒ»ã‚¨ãƒ‡ã‚£ã‚¿é ˜åŸŸ -->
    <div class="editor-pane">
        <h3>ğŸ’» SOL ã‚¨ãƒ‡ã‚£ã‚¿</h3>
        <form hx-post="/save/{{ active_day }}" hx-target="#save-message" hx-swap="innerHTML">
            <textarea name="answer_text" class="code-editor" placeholder="ã“ã“ã«SOLï¼ˆç–‘ä¼¼ã‚³ãƒ¼ãƒ‰ï¼‰ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„..."
                rows="15">{{ current_answer.answer_text if current_answer else '' }}</textarea>

            <div class="action-bar">
                <button type="submit" class="btn btn-save">ä¿å­˜ã™ã‚‹</button>
                <div id="save-message" class="toast-message"></div>

                <!-- HTMXã‚’åˆ©ç”¨ã—ã¦è§£èª¬ãƒˆã‚°ãƒ« -->
                <button type="button" class="btn btn-answer" hx-get="/answer/{{ active_day }}" hx-target="#answer-area"
                    hx-swap="innerHTML">
                    è§£ç­”ä¾‹ã‚’è¦‹ã‚‹
                </button>
            </div>
        </form>

        <!-- è§£ç­”è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆåˆæœŸçŠ¶æ…‹ã¯ç©ºã€HTMXã§å·®ã—è¾¼ã¾ã‚Œã‚‹ï¼‰ -->
        <div id="answer-area" class="answer-area"></div>
    </div>
</div>
{% endif %}